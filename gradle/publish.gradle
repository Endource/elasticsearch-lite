publishing {
  repositories {
    maven {
      name = "GitHubPackages"
      url = "https://maven.pkg.github.com/endource/elasticsearch-lite"
      credentials {
        username = System.getenv("GITHUB_ACTOR")
        password = System.getenv("GITHUB_TOKEN")
      }
    }
  }

   publications {
       maven(MavenPublication) {
           groupId = project.group
           artifactId = 'elasticsearch-lite'
           version = project.version

           from components.java
           artifact sourcesJar
           artifact javadocJar

           pom {
               name = 'My Grails Plugin'
               description = 'Lightweight Elasticsearch plugin for Grails (for seasoned ES users)'
               url = 'https://github.com/Endource/elasticsearch-lite'
               licenses {
                   license {
                       name = 'The Apache License, Version 2.0'
                       url = 'https://www.apache.org/licenses/LICENSE-2.0.txt'
                   }
               }
               developers {
                   developer {
                       id = 'endource'
                       name = 'endource'
                       email = 'paul@endource.com'
                   }
               }
               scm {
                   connection = 'scm:git:git://github.com/Endource/elasticsearch-lite.git'
                   developerConnection = 'scm:git:ssh://github.com:endource/elasticsearch-lite.git'
                   url = 'https://github.com/Endource/elasticsearch-lite/tree/main'
               }
           }
       }
   }
}

File bintrayProperties = project.rootProject.file('bintray.properties')
if (bintrayProperties.exists()) {
  Properties properties = new Properties()
  properties.load(bintrayProperties.newDataInputStream())

  ext {
    bintrayUsername = properties.bintrayUsername
    bintrayApiKey = properties.bintrayApiKey
  }

  grailsPublish {
    githubSlug = 'marcoscarceles/elasticsearch-lite'
    license {
        name = 'Apache-2.0'
    }
    title = "ElasticSearch Lite"
    desc = "Lightweight Elasticsearch plugin for Grails (for seasoned ES users)"
    developers = [marcos: 'Marcos Carceles']
  }
} else {
    grailsPublish {
    githubSlug = 'marcoscarceles/elasticsearch-lite'
    license {
        name = 'Apache-2.0'
    }
    title = "ElasticSearch Lite"
    desc = "Lightweight Elasticsearch plugin for Grails (for seasoned ES users)"
    developers = [marcos: 'Marcos Carceles']
  }
}

// Publish gh-pages on github
apply plugin: "org.ajoberstar.github-pages"

File githubProperties = project.rootProject.file('github.properties')
if (githubProperties.exists()) {
  Properties properties = new Properties()
  properties.load(githubProperties.newDataInputStream())

  ext {
    githubApiKey = properties.githubApiKey
  }

  githubPages {
    repoUri = 'https://github.com/marcoscarceles/elasticsearch-lite.git'

    credentials {
      username = project.hasProperty('githubApiKey') ? project.githubApiKey : ''
      password = ''
    }

    pages {
      from "${buildDir}/docs"
    }
  }

  task publishDocs(dependsOn: [docs, publishGhPages]) << {
  }
}
